version: '3.3'

volumes:
  data:

networks:
    appnetwork:
      driver: bridge
services:
  postgres:
    container_name: postgres
    build:
      context: ./docker/services/postgres
    image: db
    ports:
        - "5432:5432"
    networks:
      appnetwork:
        aliases:
            - postgres.docker.local

  adminer:
    container_name: adminer
    image: adminer
    restart: always
    ports:
      - 8090:8080
    depends_on:
      - postgres
    networks:
      appnetwork:
        aliases:
            - adminer.docker.local
  solr:
    container_name: solr
    image: solr:7.0
    ports:
      - 8983:8983
    volumes:
      - data:/opt/solr/server/solr/mycores
      - $PWD/solr/conf:/myconfig
    entrypoint:
      - docker-entrypoint.sh
      - solr-precreate
      - murax
      - /myconfig
    networks:
      appnetwork:
        aliases:
            - solr.docker.local
  fcrepo:
    container_name: fcrepo
    build:
      context: ./docker/services/fcrepo
      args:
        FEDORA_VERSION: 4.7.5
        FEDORA_TAG: 4.7.5
        ModeshapeConfig: jdbc-postgresql
        JDBCConfig: -Dfcrepo.postgresql.username=fedora -Dfcrepo.postgresql.password=fedora123 -Dfcrepo.postgresql.host=postgres.docker.local -Dfcrepo.postgresql.port=5432 
    image: fcrepo
    ports:
      - 8888:8080
    depends_on:
      - postgres
    networks:
      appnetwork:
        aliases:
            - fcrepo.docker.local
  web:
    stdin_open: true
    build: .
    volumes:
      - .:/usr/src/app
      - data:/storage/www/murax/shared/bundle
    depends_on:
      - postgres
      - fcrepo
      - solr
    ports:
      - "3000:3000"
      - "80:80"
      - "443:443"
    networks:
      appnetwork:
        aliases:
            - web.docker.local
